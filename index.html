<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ø —É –º–∞–º—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å | –î–µ—Ç—Å–∫–∏–π –±–∞–Ω–∫</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —à—Ä–∏—Ñ—Ç —á–µ—Ä–µ–∑ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-color: #6a5acd;
            --primary-light: #7b68ee;
            --primary-dark: #5a4fcf;
            --secondary-color: #ff6b6b;
            --success-color: #4cd964;
            --warning-color: #ff9500;
            --danger-color: #ff4757;
            --bg-color: #f5f7ff;
            --card-color: #ffffff;
            --text-color: #333333;
            --text-light: #666666;
            --border-radius: 25px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --dino-color: #8BC34A;
            --dino-dark: #689F38;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Telegram Mini App */
        body.tg-mode {
            padding: 0;
            background: #ffffff;
        }

        body.tg-mode .container {
            padding: 15px;
            max-width: 100%;
        }

        body.tg-mode .header {
            padding: 5px 0;
        }

        body.tg-mode .app-title {
            font-size: 1.4rem;
        }

        body.tg-mode .dino-character {
            font-size: 3.5rem;
        }

        body.tg-mode .type-btn {
            font-size: 0.95rem;
            padding: 12px 5px;
            min-width: calc(33.333% - 10px);
        }

        body.tg-mode .quick-amount {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        body.tg-mode #amountInput {
            font-size: 1.8rem;
            padding: 15px;
        }

        body.tg-mode .currency-display {
            font-size: 1.5rem;
            right: 15px;
        }

        body.tg-mode .btn-submit {
            padding: 15px;
            font-size: 1.1rem;
        }

        body.tg-mode .dino-message {
            white-space: normal;
            max-width: 120px;
            padding: 8px 10px;
            font-size: 0.8rem;
            word-break: break-word;
        }

        body {
            font-family: 'Nunito', 'Comic Neue', 'Comic Sans MS', 'Chilanka', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7ff 0%, #e3e8ff 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            transition: var(--transition);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        /* –°–∫—Ä—ã—Ç–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ */
        body {
            position: relative;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            text-align: center;
            padding: 10px 0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .header-left {
            flex: 1;
            display: flex;
            justify-content: flex-start;
        }

        .header-center {
            flex: 2;
            text-align: center;
        }

        .header-right {
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }

        .app-title {
            color: var(--primary-color);
            font-size: 1.6rem;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
            font-weight: 900;
            font-family: 'Nunito', 'Comic Neue', sans-serif;
        }

        .help-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-light);
            color: white;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            z-index: 100;
        }

        .help-btn:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        .profile-selector {
            display: flex;
            justify-content: center;
        }

        .btn-profile {
            background: white;
            border: 3px solid var(--primary-color);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-family: inherit;
            white-space: nowrap;
            font-weight: 700;
        }

        .btn-profile:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        /* –ö–∞—Ä—Ç–∞ —Å –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–º */
        .card-container {
            position: relative;
            perspective: 1000px;
            min-height: 220px;
            margin-top: 10px;
        }

        .bank-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-radius: var(--border-radius);
            padding: 25px;
            color: white;
            box-shadow: var(--shadow);
            transform-style: preserve-3d;
            transition: transform 0.6s;
            position: relative;
            overflow: hidden;
            min-height: 220px;
        }

        .bank-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            transform: rotate(30deg);
            opacity: 0.3;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .card-chip {
            width: 40px;
            height: 30px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 5px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 5px;
        }

        .chip-line {
            height: 3px;
            background: rgba(0,0,0,0.2);
            border-radius: 2px;
        }

        .card-logo {
            font-size: 2rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 900;
        }

        .card-number {
            font-size: 1.3rem;
            letter-spacing: 2px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-weight: 700;
        }

        .card-holder, .card-balance {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
        }

        .holder-label, .balance-label {
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: 700;
        }

        .holder-name {
            font-size: 1.2rem;
            font-weight: 900;
            font-family: 'Nunito', sans-serif;
        }

        .balance-amount {
            display: flex;
            align-items: baseline;
            gap: 5px;
        }

        .currency-symbol {
            font-size: 1.5rem;
            font-weight: 900;
        }

        .balance-digits {
            font-size: 2.5rem;
            font-weight: 900;
            font-family: 'Courier New', monospace;
            transition: transform 0.3s ease;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .valid-thru {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 700;
        }

        .mastercard-logo {
            font-size: 1.5rem;
        }

        /* –î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç—ã - –æ–ø—É—Å–∫–∞–µ–º –Ω–∏–∂–µ */
        .dino-overlay {
            position: absolute;
            top: 15px; /* –û–ø—É—Å–∫–∞–µ–º –¥–∏–Ω–æ–∑–∞–≤—Ä–∞ */
            right: 20px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dino-character {
            font-size: 4rem; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º */
            cursor: pointer;
            transition: var(--transition);
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.3));
            position: relative;
            z-index: 2;
            line-height: 1;
        }

        .dino-message {
            position: absolute;
            top: -45px;
            background: white;
            color: var(--text-color);
            padding: 10px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            box-shadow: var(--shadow);
            animation: pulse 2s infinite;
            z-index: 3;
            text-align: center;
            max-width: 140px;
            min-width: 120px;
            border: 2px solid var(--primary-light);
            font-weight: 700;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.3;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–∏–Ω–æ–∑–∞–≤—Ä–∞ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes happyJump {
            0%, 100% { transform: translateY(0) scale(1); }
            30% { transform: translateY(-30px) scale(1.2); }
            70% { transform: translateY(-15px) scale(1.1); }
        }

        @keyframes sadShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes penalty {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.8); }
        }

        .dino-happy {
            animation: happyJump 0.8s ease, float 3s ease-in-out infinite;
            color: #4CAF50;
        }

        .dino-sad {
            animation: sadShake 0.5s ease, float 3s ease-in-out infinite;
            color: #f44336;
        }

        .dino-penalty {
            animation: penalty 0.5s ease, float 3s ease-in-out infinite;
            color: #ff6b6b;
        }

        .dino-spin {
            animation: spin 1s linear;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã */
        .currency-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
        }

        .currency-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary-color);
            background: white;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            font-weight: 700;
        }

        .currency-btn.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.2);
        }

        .currency-btn:hover:not(.active) {
            background: var(--primary-light);
            color: white;
        }

        /* –§–æ—Ä–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ - –ú–ï–ù–Ø–ï–ú –ü–û–†–Ø–î–û–ö */
        .operation-form {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .operation-type {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .type-btn {
            flex: 1;
            min-width: calc(33.333% - 10px);
            padding: 15px 8px;
            border: 2px solid transparent;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            font-weight: 700;
            text-align: center;
        }

        .type-btn[data-type="income"] {
            background: #e8f5e9;
            color: #2e7d32;
            border-color: #4caf50;
        }

        .type-btn[data-type="expense"] {
            background: #ffebee;
            color: #c62828;
            border-color: #f44336;
        }

        .type-btn[data-type="penalty"] {
            background: #fff3e0;
            color: #e65100;
            border-color: #ff9800;
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–∫ —É –≤–∞–ª—é—Ç—ã */
        .type-btn.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        .type-btn.active[data-type="income"] {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .type-btn.active[data-type="expense"] {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .type-btn.active[data-type="penalty"] {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
        }

        /* –ü–æ–º–µ–Ω—è–ª–∏ –ø–æ—Ä—è–¥–æ–∫: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—Ç–æ–º —Å—É–º–º–∞ */
        .reason-input {
            margin-bottom: 20px;
        }

        #reasonInput {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-family: inherit;
            transition: var(--transition);
            font-weight: 700;
        }

        #reasonInput:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .amount-input {
            position: relative;
            margin-bottom: 20px;
        }

        #amountInput {
            width: 100%;
            padding: 20px;
            font-size: 2.5rem;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            transition: var(--transition);
        }

        #amountInput:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.2);
        }

        .currency-display {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary-color);
        }

        .quick-amounts {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-amount {
            padding: 12px 20px;
            background: #f0f2ff;
            border: 2px solid var(--primary-light);
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 900;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            flex: 1;
            min-width: calc(20% - 8px);
            text-align: center;
        }

        .quick-amount:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-3px);
        }

        .btn-submit {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 900;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
        }

        .btn-submit:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(106, 90, 205, 0.3);
        }

        .btn-submit:active {
            transform: translateY(-2px);
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ */
        .history-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 900;
        }

        .history-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 15px;
            background: #f0f2ff;
            border: 2px solid var(--primary-light);
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            flex: 1;
            min-width: calc(25% - 8px);
            text-align: center;
        }

        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.2);
        }

        .filter-btn:hover:not(.active) {
            background: var(--primary-light);
            color: white;
        }

        .history-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-clear-history {
            background: #ffebee;
            color: #f44336;
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
            font-family: inherit;
            font-weight: 700;
        }

        .btn-clear-history:hover {
            background: #f44336;
            color: white;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .empty-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #f5f5f5;
            animation: slideIn 0.5s ease;
            position: relative;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .history-icon {
            font-size: 1.5rem;
            width: 40px;
        }

        .history-details {
            flex: 1;
            padding: 0 15px;
        }

        .history-reason {
            font-weight: 900;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 700;
        }

        .history-amount {
            font-size: 1.2rem;
            font-weight: 900;
            font-family: 'Courier New', monospace;
        }

        .history-amount.income {
            color: #4caf50;
        }

        .history-amount.expense {
            color: #f44336;
        }

        .history-amount.penalty {
            color: #ff9800;
        }

        /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ */
        .history-delete-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0.7;
            padding: 5px;
            margin-left: 10px;
        }

        .history-delete-btn:hover {
            color: #f44336;
            opacity: 1;
            transform: scale(1.2);
        }

        /* –ü–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª–µ–π */
        .profiles-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            padding: 20px;
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
        }

        .profiles-panel.active {
            right: 0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f5f5f5;
        }

        .btn-close-panel {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        .btn-close-panel:hover {
            color: var(--primary-color);
            transform: rotate(90deg);
        }

        .profile-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f9f9ff;
            border-radius: 15px;
            margin-bottom: 10px;
            border: 2px solid #eee;
            transition: var(--transition);
        }

        .profile-item.active {
            border-color: var(--primary-color);
            background: #f0f2ff;
        }

        .profile-item:hover {
            transform: translateX(5px);
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar {
            font-size: 2rem;
        }

        .profile-name {
            font-size: 1.2rem;
            font-weight: 900;
        }

        .profile-balance {
            font-family: 'Courier New', monospace;
            font-weight: 900;
            color: var(--primary-color);
        }

        .profile-actions {
            display: flex;
            gap: 10px;
        }

        .btn-delete-profile {
            background: #ffebee;
            color: #f44336;
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 5px 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-delete-profile:hover {
            background: #f44336;
            color: white;
        }

        .add-profile-form {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 3px solid #f5f5f5;
        }

        #newChildName {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: inherit;
            font-weight: 700;
        }

        .btn-add-profile {
            padding: 15px 25px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
            font-weight: 700;
        }

        .btn-add-profile:hover {
            background: var(--primary-light);
            transform: translateY(-3px);
        }

        /* –ü–∞–Ω–µ–ª—å –ø–æ–º–æ—â–∏ */
        .help-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            padding: 20px;
            transition: var(--transition);
            z-index: 1001;
            overflow-y: auto;
        }

        .help-panel.active {
            right: 0;
        }

        .help-content {
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            padding-right: 10px;
        }

        .help-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f5f5f5;
        }

        .help-section:last-child {
            border-bottom: none;
        }

        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 900;
        }

        .help-section p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: var(--text-color);
            font-weight: 700;
        }

        .help-section ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .help-section li {
            margin-bottom: 8px;
            line-height: 1.5;
            font-weight: 700;
        }

        .wallet-address {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            margin: 15px 0;
            border: 1px solid #ddd;
            text-align: center;
            font-weight: 700;
        }

        .wallet-title {
            font-weight: 900;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .bot-link {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 900;
            margin-top: 10px;
            transition: var(--transition);
        }

        .bot-link:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .share-section {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-share {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
            font-weight: 900;
        }

        .btn-share:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.3);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ */
        @keyframes flipDigit {
            0% {
                transform: rotateX(0);
                opacity: 1;
            }
            50% {
                transform: rotateX(90deg);
                opacity: 0;
            }
            51% {
                transform: rotateX(-90deg);
                opacity: 0;
            }
            100% {
                transform: rotateX(0);
                opacity: 1;
            }
        }

        .flip-animation {
            animation: flipDigit 0.6s ease-out;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç—ã */
        @keyframes cardBounce {
            0%, 100% { transform: translateY(0) rotateX(0); }
            25% { transform: translateY(-10px) rotateX(5deg); }
            75% { transform: translateY(5px) rotateX(-2deg); }
        }

        .card-bounce {
            animation: cardBounce 0.8s ease;
        }

        /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                flex-direction: row;
                gap: 5px;
                margin-bottom: 5px;
            }
            
            .header-left, .header-center, .header-right {
                width: auto;
                justify-content: center;
            }
            
            .app-title {
                font-size: 1.3rem;
                margin-top: 0;
                line-height: 1.1;
            }
            
            .btn-profile {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            
            .help-btn {
                position: static;
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            
            .bank-card {
                padding: 20px;
                min-height: 200px;
            }
            
            .dino-character {
                font-size: 3rem;
            }
            
            .dino-overlay {
                right: 10px;
                top: 10px;
            }
            
            .dino-message {
                max-width: 110px;
                min-width: 100px;
                font-size: 0.75rem;
                padding: 6px 8px;
                top: -40px;
            }
            
            .balance-digits {
                font-size: 2rem;
            }
            
            .operation-form {
                padding: 20px;
            }
            
            #amountInput {
                font-size: 2rem;
                padding: 15px;
            }
            
            .currency-display {
                font-size: 1.5rem;
                right: 15px;
            }
            
            .type-btn {
                min-width: calc(33.333% - 5px);
                font-size: 0.9rem;
                padding: 10px 5px;
                gap: 5px;
            }
            
            .quick-amounts {
                gap: 5px;
            }
            
            .quick-amount {
                padding: 8px 10px;
                font-size: 0.9rem;
                min-width: calc(20% - 4px);
            }
            
            .filter-btn {
                min-width: calc(50% - 5px);
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            
            .btn-submit {
                padding: 15px;
                font-size: 1.1rem;
            }
        }

        /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: none;
        }

        .stats-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f9f9ff;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 2px solid #eee;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary-color);
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 700;
        }

        .stat-positive {
            color: #4CAF50;
        }

        .stat-negative {
            color: #f44336;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: #f0f2ff;
            border: 2px solid var(--primary-light);
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.2);
        }

        .tab-btn:hover:not(.active) {
            background: var(--primary-light);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <button class="btn-profile" id="selectChildBtn">
                    <span id="currentChildAvatar">üë¶</span>
                    <span id="currentChildName">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="header-center">
                <h1 class="app-title">–Ø —É –º–∞–º—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</h1>
            </div>
            <div class="header-right">
                <button class="help-btn" id="helpBtn">
                    <i class="fas fa-question"></i>
                </button>
            </div>
        </header>

        <div class="card-container">
            <div class="bank-card" id="bankCard">
                <div class="card-header">
                    <div class="card-chip">
                        <div class="chip-line"></div>
                        <div class="chip-line"></div>
                        <div class="chip-line"></div>
                    </div>
                    <div class="card-logo">üí∞</div>
                </div>
                <div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ <span id="lastDigits">1234</span></div>
                <div class="card-holder">
                    <div class="holder-label">–í–õ–ê–î–ï–õ–ï–¶</div>
                    <div class="holder-name" id="cardHolderName">–ò–ú–Ø –†–ï–ë–ï–ù–ö–ê</div>
                </div>
                <div class="card-balance">
                    <div class="balance-label">–ë–ê–õ–ê–ù–°</div>
                    <div class="balance-amount" id="balanceAmount">
                        <span class="currency-symbol">‚ÇΩ</span>
                        <span class="balance-digits">0</span>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="valid-thru">–î–ï–¢–°–ö–ò–ô –ë–ê–ù–ö</div>
                    <div class="mastercard-logo">üí≥</div>
                </div>
            </div>
            
            <div class="dino-overlay">
                <div class="dino-message" id="dinoMessage">–î–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é!</div>
                <div class="dino-character" id="dinoCharacter">ü¶ï</div>
            </div>
        </div>

        <div class="currency-selector">
            <button class="currency-btn active" data-currency="RUB">
                <span class="flag">üá∑üá∫</span> ‚ÇΩ
            </button>
            <button class="currency-btn" data-currency="USD">
                <span class="flag">üá∫üá∏</span> $
            </button>
            <button class="currency-btn" data-currency="EUR">
                <span class="flag">üá™üá∫</span> ‚Ç¨
            </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –ò—Å—Ç–æ—Ä–∏—è/–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="history">üìä –ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="tab-btn" data-tab="stats">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <!-- –§–æ—Ä–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div class="operation-form">
            <div class="operation-type">
                <button class="type-btn active" data-type="income">
                    <i class="fas fa-plus-circle"></i> –ó–∞—Ä–∞–±–æ—Ç–∞–ª
                </button>
                <button class="type-btn" data-type="expense">
                    <i class="fas fa-minus-circle"></i> –ü–æ—Ç—Ä–∞—Ç–∏–ª
                </button>
                <button class="type-btn" data-type="penalty">
                    <i class="fas fa-exclamation-triangle"></i> –®—Ç—Ä–∞—Ñ
                </button>
            </div>
            
            <!-- –ü–û–ú–ï–ù–Ø–õ–ò –ü–û–†–Ø–î–û–ö: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—Ç–æ–º —Å—É–º–º–∞ -->
            <div class="reason-input">
                <input type="text" id="reasonInput" placeholder="–ó–∞ —á—Ç–æ? –ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–º—ã–ª –ø–æ—Å—É–¥—É">
            </div>
            
            <div class="amount-input">
                <input type="number" id="amountInput" placeholder="–°—É–º–º–∞" min="0" step="10">
                <span class="currency-display" id="currencyDisplay">‚ÇΩ</span>
            </div>
            
            <div class="quick-amounts">
                <button class="quick-amount" data-amount="10">10</button>
                <button class="quick-amount" data-amount="50">50</button>
                <button class="quick-amount" data-amount="100">100</button>
                <button class="quick-amount" data-amount="200">200</button>
                <button class="quick-amount" data-amount="500">500</button>
            </div>
            
            <button class="btn-submit" id="submitOperation">
                <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
            </button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="history-section active" id="historyTab">
            <h2 class="section-title">
                <i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
            </h2>
            
            <div class="history-controls">
                <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                <button class="filter-btn" data-filter="week">–ù–µ–¥–µ–ª—è</button>
                <button class="filter-btn" data-filter="month">–ú–µ—Å—è—Ü</button>
                <button class="filter-btn" data-filter="year">–ì–æ–¥</button>
            </div>
            
            <div class="history-actions">
                <button class="btn-clear-history" id="clearHistoryBtn">
                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
                </button>
            </div>
            
            <div class="history-list" id="historyList">
                <div class="empty-history">
                    <i class="fas fa-book"></i>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="stats-section" id="statsTab">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </h2>
            
            <div class="history-controls">
                <button class="filter-btn active" data-stat-filter="all">–í—Å–µ –≤—Ä–µ–º—è</button>
                <button class="filter-btn" data-stat-filter="week">–ù–µ–¥–µ–ª—è</button>
                <button class="filter-btn" data-stat-filter="month">–ú–µ—Å—è—Ü</button>
                <button class="filter-btn" data-stat-filter="year">–ì–æ–¥</button>
            </div>
            
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                    <div class="stat-value stat-positive" id="totalIncome">0 ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                    <div class="stat-value stat-negative" id="totalExpense">0 ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ —à—Ç—Ä–∞—Ñ–æ–≤</div>
                    <div class="stat-value stat-negative" id="totalPenalty">0 ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥</div>
                    <div class="stat-value" id="netIncome">0 ‚ÇΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–û–ø–µ—Ä–∞—Ü–∏–π</div>
                    <div class="stat-value" id="totalOperations">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ–ø–µ—Ä–∞—Ü–∏—è</div>
                    <div class="stat-value" id="averageOperation">0 ‚ÇΩ</div>
                </div>
            </div>
        </div>

        <div class="share-section">
            <button class="btn-share" id="shareBtn">
                <i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
            </button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏ -->
        <div class="profiles-panel" id="profilesPanel">
            <div class="panel-header">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç—å–º–∏</h3>
                <button class="btn-close-panel" id="closePanelBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="profiles-list" id="profilesList"></div>
            <div class="add-profile-form">
                <input type="text" id="newChildName" placeholder="–ò–º—è —Ä–µ–±–µ–Ω–∫–∞" maxlength="20">
                <button class="btn-add-profile" id="addProfileBtn">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞
                </button>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –ø–æ–º–æ—â–∏ -->
        <div class="help-panel" id="helpPanel">
            <div class="panel-header">
                <h3>–ü–æ–º–æ—â—å –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <button class="btn-close-panel" id="closeHelpBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <h3>–ó–∞—á–µ–º —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?</h3>
                    <p>–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –¥–µ—Ç—è–º –≤ –∏–≥—Ä–æ–≤–æ–π —Ñ–æ—Ä–º–µ –Ω–∞—É—á–∏—Ç—å—Å—è:</p>
                    <ul>
                        <li>–ü–æ–Ω–∏–º–∞—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–Ω–µ–≥ –∏ —Ç—Ä—É–¥–∞</li>
                        <li>–°—Ç–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏ –∏ –∫–æ–ø–∏—Ç—å –Ω–∞ –Ω–∏—Ö</li>
                        <li>–ë—ã—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞ —Å–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è</li>
                        <li>–†–∞–∑–≤–∏–≤–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ</li>
                        <li>–£—á–∏—Ç—å—Å—è —Å—á–∏—Ç–∞—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç</li>
                    </ul>
                    <p>–° –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç:</p>
                    <ul>
                        <li>–§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ —É—Å–ø–µ—Ö–∞</li>
                        <li>–†–∞–∑–≤–∏–≤–∞—Ç—å —Å–∞–º–æ–¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</li>
                        <li>–£–∫—Ä–µ–ø–ª—è—Ç—å —Å–≤—è–∑—å –º–µ–∂–¥—É —É—Å–∏–ª–∏–µ–º –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</li>
                        <li>–ü–æ–≤—ã—à–∞—Ç—å —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É —á–µ—Ä–µ–∑ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>–ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h3>
                    <p>–ï—Å–ª–∏ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ:</p>
                    <div class="wallet-address">
                        <div class="wallet-title">USDT (—Å–µ—Ç—å TON)</div>
                        UQDnIYvQ1-q1gQtNfj5hl4jigV3QNqo7EyGuPtsjUew5B0sP
                    </div>
                    <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É! üíú</p>
                </div>

                <div class="help-section">
                    <h3>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è</h3>
                    <p>–£ –≤–∞—Å –µ—Å—Ç—å –∏–¥–µ–∏ –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ? –ù–∞—à–ª–∏ –æ—à–∏–±–∫—É? –•–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é?</p>
                    <p>–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram:</p>
                    <a href="https://t.me/sonya_asistentka_bot" class="bot-link" target="_blank">
                        <i class="fab fa-telegram"></i> @sonya_asistentka_bot
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        class KidBank {
            constructor() {
                this.currentCurrency = 'RUB';
                this.currentChild = null;
                this.children = this.loadFromStorage('children') || [];
                this.operations = this.loadFromStorage('operations') || {};
                this.penaltyAmount = 100;
                this.currentDino = 'ü¶ï';
                this.currentFilter = 'all';
                this.currentStatFilter = 'all';
                this.activeTab = 'history';
                this.exchangeRates = {
                    RUB: 1,
                    USD: 0.011,
                    EUR: 0.010
                };
                this.dinoMessages = [
                    '–¢—ã –∫—Ä—É—Ç!', '–ü—Ä–æ–¥–æ–ª–∂–∞–π –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å!', '–¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è!',
                    '–£ —Ç–µ–±—è –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è!', '–Ø –≤ —Ç–µ–±–µ –≤–µ—Ä—é!', '–¢—ã –±—É–¥—É—â–∏–π –º–∏–ª–ª–∏–æ–Ω–µ—Ä!',
                    '–ö–∞–∂–¥–∞—è –∫–æ–ø–µ–π–∫–∞ –≤–∞–∂–Ω–∞!', '–†–∞–±–æ—Ç–∞–π —É–º–Ω–µ–µ!', '–¢—ã –ª—É—á—à–µ –≤—Å–µ—Ö!', '–ù–µ —Å–¥–∞–≤–∞–π—Å—è!'
                ];
                
                this.init();
            }
            
            init() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Mini App
                this.checkTelegramMode();
                
                this.setupEventListeners();
                this.loadProfiles();
                this.updateUI();
                this.setupKeyboardHide();
            }
            
            checkTelegramMode() {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('tg1')) {
                    document.body.classList.add('tg-mode');
                    document.body.style.fontFamily = "'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif";
                }
            }
            
            setupEventListeners() {
                // –í—ã–±–æ—Ä —Ä–µ–±–µ–Ω–∫–∞
                document.getElementById('selectChildBtn').addEventListener('click', () => {
                    document.getElementById('profilesPanel').classList.add('active');
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
                document.getElementById('closePanelBtn').addEventListener('click', () => {
                    document.getElementById('profilesPanel').classList.remove('active');
                });
                
                // –ü–∞–Ω–µ–ª—å –ø–æ–º–æ—â–∏
                document.getElementById('helpBtn').addEventListener('click', () => {
                    document.getElementById('helpPanel').classList.add('active');
                });
                
                document.getElementById('closeHelpBtn').addEventListener('click', () => {
                    document.getElementById('helpPanel').classList.remove('active');
                });
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                document.getElementById('addProfileBtn').addEventListener('click', () => {
                    this.addChild();
                });
                
                document.getElementById('newChildName').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addChild();
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
                document.querySelectorAll('.type-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —à—Ç—Ä–∞—Ñ, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º —Å—É–º–º—É —à—Ç—Ä–∞—Ñ–∞
                        if (btn.dataset.type === 'penalty') {
                            document.getElementById('amountInput').value = this.penaltyAmount;
                        }
                    });
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
                document.querySelectorAll('.currency-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.currentCurrency = btn.dataset.currency;
                        document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.updateUI();
                    });
                });
                
                // –ë—ã—Å—Ç—Ä–∞—è —Å—É–º–º–∞
                document.querySelectorAll('.quick-amount').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.getElementById('amountInput').value = btn.dataset.amount;
                    });
                });
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
                document.getElementById('submitOperation').addEventListener('click', () => {
                    this.addOperation();
                });
                
                // –í–≤–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ Enter
                document.getElementById('amountInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addOperation();
                });
                
                document.getElementById('reasonInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addOperation();
                });
                
                // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
                document.getElementById('clearHistoryBtn').addEventListener('click', () => {
                    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π?')) {
                        if (this.currentChild) {
                            this.operations[this.currentChild.id] = [];
                            this.saveToStorage('operations', this.operations);
                            this.updateHistory();
                            this.updateStats();
                            this.showDinoMessage('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!', 'sad');
                        }
                    }
                });
                
                // –ö–ª–∏–∫ –ø–æ –¥–∏–Ω–æ–∑–∞–≤—Ä—É
                document.getElementById('dinoCharacter').addEventListener('click', () => {
                    this.showRandomDinoMessage();
                });
                
                // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                document.getElementById('shareBtn').addEventListener('click', () => {
                    this.shareApp();
                });
                
                // –§–∏–ª—å—Ç—Ä—ã –∏—Å—Ç–æ—Ä–∏–∏
                document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.currentFilter = btn.dataset.filter;
                        document.querySelectorAll('.filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.updateHistory();
                    });
                });
                
                // –§–∏–ª—å—Ç—Ä—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                document.querySelectorAll('.filter-btn[data-stat-filter]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.currentStatFilter = btn.dataset.filter;
                        document.querySelectorAll('.filter-btn[data-stat-filter]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.updateStats();
                    });
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.activeTab = btn.dataset.tab;
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                        document.getElementById('historyTab').classList.remove('active');
                        document.getElementById('statsTab').classList.remove('active');
                        document.getElementById(this.activeTab + 'Tab').classList.add('active');
                        
                        if (this.activeTab === 'stats') {
                            this.updateStats();
                        }
                    });
                });
            }
            
            // –°–∫—Ä—ã—Ç–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ
            setupKeyboardHide() {
                document.body.addEventListener('click', (e) => {
                    // –ï—Å–ª–∏ –∫–ª–∏–∫ –Ω–µ –ø–æ –ø–æ–ª—é –≤–≤–æ–¥–∞
                    if (!e.target.matches('input') && !e.target.matches('textarea')) {
                        // –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                        if (document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')) {
                            document.activeElement.blur();
                            
                            // –ù–∞ iOS –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
                            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                                document.activeElement.blur();
                            }
                        }
                    }
                });
                
                // –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
                window.addEventListener('scroll', () => {
                    if (document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')) {
                        document.activeElement.blur();
                    }
                });
            }
            
            loadProfiles() {
                if (this.children.length === 0) {
                    const demoChild = {
                        id: Date.now().toString(),
                        name: '–î–µ–º–æ –†–µ–±–µ–Ω–æ–∫',
                        avatar: 'üë¶',
                        balance: 1000,
                        createdAt: new Date().toISOString()
                    };
                    this.children.push(demoChild);
                    this.saveToStorage('children', this.children);
                    
                    this.operations[demoChild.id] = [
                        {
                            id: '1',
                            type: 'income',
                            amount: 500,
                            reason: '–ü–æ–º—ã–ª –ø–æ—Å—É–¥—É',
                            date: new Date().toISOString()
                        },
                        {
                            id: '2',
                            type: 'income',
                            amount: 300,
                            reason: '–°–¥–µ–ª–∞–ª —É—Ä–æ–∫–∏',
                            date: new Date(Date.now() - 86400000).toISOString()
                        },
                        {
                            id: '3',
                            type: 'penalty',
                            amount: 100,
                            reason: '–û–ø–æ–∑–¥–∞–ª –≤ —à–∫–æ–ª—É',
                            date: new Date(Date.now() - 172800000).toISOString()
                        }
                    ];
                    this.saveToStorage('operations', this.operations);
                }
                
                if (!this.currentChild && this.children.length > 0) {
                    this.currentChild = this.children[0];
                }
                
                this.renderProfilesList();
            }
            
            renderProfilesList() {
                const profilesList = document.getElementById('profilesList');
                profilesList.innerHTML = '';
                
                this.children.forEach(child => {
                    const childBalance = this.getChildBalance(child.id);
                    const isActive = this.currentChild && this.currentChild.id === child.id;
                    
                    const profileItem = document.createElement('div');
                    profileItem.className = `profile-item ${isActive ? 'active' : ''}`;
                    profileItem.innerHTML = `
                        <div class="profile-info">
                            <div class="profile-avatar">${child.avatar}</div>
                            <div>
                                <div class="profile-name">${child.name}</div>
                                <div class="profile-balance">${this.formatCurrency(childBalance)}</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn-delete-profile" data-id="${child.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    profileItem.querySelector('.profile-info').addEventListener('click', () => {
                        this.selectChild(child.id);
                        document.getElementById('profilesPanel').classList.remove('active');
                    });
                    
                    profileItem.querySelector('.btn-delete-profile').addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å "${child.name}"?`)) {
                            this.deleteChild(child.id);
                        }
                    });
                    
                    profilesList.appendChild(profileItem);
                });
            }
            
            addChild() {
                const nameInput = document.getElementById('newChildName');
                const name = nameInput.value.trim();
                
                if (name.length < 2 || name.length > 20) {
                    alert('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤');
                    return;
                }
                
                const avatars = ['üë¶', 'üëß', 'üßí', 'üë∂', 'ü§¥', 'üë∏', 'ü¶∏', 'ü¶∏‚Äç‚ôÄÔ∏è', 'üßô', 'üßô‚Äç‚ôÄÔ∏è'];
                const randomAvatar = avatars[Math.floor(Math.random() * avatars.length)];
                
                const newChild = {
                    id: Date.now().toString(),
                    name: name,
                    avatar: randomAvatar,
                    balance: 0,
                    createdAt: new Date().toISOString()
                };
                
                this.children.push(newChild);
                this.saveToStorage('children', this.children);
                
                this.operations[newChild.id] = [];
                this.saveToStorage('operations', this.operations);
                
                nameInput.value = '';
                this.selectChild(newChild.id);
                this.renderProfilesList();
                document.getElementById('profilesPanel').classList.remove('active');
                this.showDinoMessage(`–ü—Ä–∏–≤–µ—Ç, ${name}!`, 'happy');
            }
            
            deleteChild(childId) {
                this.children = this.children.filter(child => child.id !== childId);
                delete this.operations[childId];
                
                if (this.currentChild && this.currentChild.id === childId) {
                    this.currentChild = this.children.length > 0 ? this.children[0] : null;
                }
                
                this.saveToStorage('children', this.children);
                this.saveToStorage('operations', this.operations);
                this.renderProfilesList();
                this.updateUI();
            }
            
            selectChild(childId) {
                this.currentChild = this.children.find(child => child.id === childId);
                if (this.currentChild) {
                    this.updateUI();
                    this.showDinoMessage(`–ü—Ä–∏–≤–µ—Ç, ${this.currentChild.name}!`, 'happy');
                }
            }
            
            addOperation() {
                if (!this.currentChild) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞!');
                    return;
                }
                
                const amountInput = document.getElementById('amountInput');
                const reasonInput = document.getElementById('reasonInput');
                const typeBtn = document.querySelector('.type-btn.active');
                
                const amount = parseInt(amountInput.value);
                const reason = reasonInput.value.trim();
                const type = typeBtn.dataset.type;
                
                if (!amount || amount <= 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!');
                    return;
                }
                
                if (!reason) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ–ø–µ—Ä–∞—Ü–∏–∏!');
                    return;
                }
                
                const operation = {
                    id: Date.now().toString(),
                    type: type,
                    amount: amount,
                    reason: reason,
                    date: new Date().toISOString()
                };
                
                if (!this.operations[this.currentChild.id]) {
                    this.operations[this.currentChild.id] = [];
                }
                this.operations[this.currentChild.id].unshift(operation);
                this.saveToStorage('operations', this.operations);
                
                if (type === 'income') {
                    this.currentChild.balance = (this.currentChild.balance || 0) + amount;
                    this.showDinoMessage(`+${amount} ${this.getCurrencySymbol()}! –ú–æ–ª–æ–¥–µ—Ü!`, 'happy');
                    this.animateDino('happy');
                } else if (type === 'expense') {
                    this.currentChild.balance = (this.currentChild.balance || 0) - amount;
                    this.showDinoMessage(`-${amount} ${this.getCurrencySymbol()}... –ë—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ!`, 'sad');
                    this.animateDino('sad');
                } else if (type === 'penalty') {
                    this.currentChild.balance = (this.currentChild.balance || 0) - amount;
                    this.showDinoMessage(`–®—Ç—Ä–∞—Ñ ${amount} ${this.getCurrencySymbol()}!`, 'penalty');
                    this.animateDino('penalty');
                }
                
                const childIndex = this.children.findIndex(c => c.id === this.currentChild.id);
                if (childIndex !== -1) {
                    this.children[childIndex] = this.currentChild;
                    this.saveToStorage('children', this.children);
                }
                
                amountInput.value = '';
                reasonInput.value = '';
                
                this.animateBalanceChange();
                this.updateHistory();
                this.updateStats();
                
                document.getElementById('bankCard').classList.add('card-bounce');
                setTimeout(() => {
                    document.getElementById('bankCard').classList.remove('card-bounce');
                }, 800);
            }
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
            deleteOperation(operationId) {
                if (!this.currentChild || !confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é?')) {
                    return;
                }
                
                const childOperations = this.operations[this.currentChild.id];
                if (childOperations) {
                    const operationIndex = childOperations.findIndex(op => op.id === operationId);
                    if (operationIndex !== -1) {
                        const operation = childOperations[operationIndex];
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–∞–Ω—Å
                        if (operation.type === 'income') {
                            this.currentChild.balance = (this.currentChild.balance || 0) - operation.amount;
                        } else {
                            this.currentChild.balance = (this.currentChild.balance || 0) + operation.amount;
                        }
                        
                        // –£–¥–∞–ª—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
                        childOperations.splice(operationIndex, 1);
                        this.saveToStorage('operations', this.operations);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–±–µ–Ω–∫–∞
                        const childIndex = this.children.findIndex(c => c.id === this.currentChild.id);
                        if (childIndex !== -1) {
                            this.children[childIndex] = this.currentChild;
                            this.saveToStorage('children', this.children);
                        }
                        
                        this.showDinoMessage('–û–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'sad');
                        this.updateBalanceDisplay();
                        this.updateHistory();
                        this.updateStats();
                    }
                }
            }
            
            animateBalanceChange() {
                const balanceDigits = document.querySelector('.balance-digits');
                balanceDigits.classList.add('flip-animation');
                
                setTimeout(() => {
                    balanceDigits.classList.remove('flip-animation');
                }, 600);
                
                this.updateBalanceDisplay();
            }
            
            updateBalanceDisplay() {
                const balanceElement = document.getElementById('balanceAmount');
                const balance = this.currentChild ? (this.currentChild.balance || 0) : 0;
                const convertedBalance = this.convertCurrency(balance);
                
                balanceElement.querySelector('.balance-digits').textContent = convertedBalance.toLocaleString('ru-RU', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
                
                balanceElement.querySelector('.currency-symbol').textContent = this.getCurrencySymbol();
                document.getElementById('currencyDisplay').textContent = this.getCurrencySymbol();
                
                document.getElementById('lastDigits').textContent = 
                    Math.floor(1000 + Math.random() * 9000);
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            filterOperations(operations, filter) {
                if (!operations || filter === 'all') {
                    return operations;
                }
                
                const now = new Date();
                const filtered = operations.filter(operation => {
                    const opDate = new Date(operation.date);
                    
                    switch(filter) {
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return opDate >= weekAgo;
                        case 'month':
                            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                            return opDate >= monthAgo;
                        case 'year':
                            const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                            return opDate >= yearAgo;
                        default:
                            return true;
                    }
                });
                
                return filtered;
            }
            
            updateHistory() {
                const historyList = document.getElementById('historyList');
                
                if (!this.currentChild || !this.operations[this.currentChild.id] || this.operations[this.currentChild.id].length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-history">
                            <i class="fas fa-book"></i>
                            <p>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>
                        </div>
                    `;
                    return;
                }
                
                historyList.innerHTML = '';
                const childOperations = this.operations[this.currentChild.id];
                const filteredOperations = this.filterOperations(childOperations, this.currentFilter);
                
                if (filteredOperations.length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-history">
                            <i class="fas fa-search"></i>
                            <p>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
                        </div>
                    `;
                    return;
                }
                
                filteredOperations.forEach(operation => {
                    const operationDate = new Date(operation.date);
                    const formattedDate = operationDate.toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const convertedAmount = this.convertCurrency(operation.amount);
                    
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-icon">
                            ${operation.type === 'income' ? 'üíµ' : operation.type === 'penalty' ? '‚öñÔ∏è' : 'üí∏'}
                        </div>
                        <div class="history-details">
                            <div class="history-reason">${operation.reason}</div>
                            <div class="history-date">${formattedDate}</div>
                        </div>
                        <div class="history-amount ${operation.type}">
                            ${operation.type === 'income' ? '+' : '-'}${convertedAmount} ${this.getCurrencySymbol()}
                        </div>
                        <button class="history-delete-btn" data-id="${operation.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è
                    const deleteBtn = historyItem.querySelector('.history-delete-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteOperation(operation.id);
                    });
                    
                    historyList.appendChild(historyItem);
                });
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStats() {
                if (!this.currentChild || !this.operations[this.currentChild.id]) {
                    document.getElementById('totalIncome').textContent = '0 ' + this.getCurrencySymbol();
                    document.getElementById('totalExpense').textContent = '0 ' + this.getCurrencySymbol();
                    document.getElementById('totalPenalty').textContent = '0 ' + this.getCurrencySymbol();
                    document.getElementById('netIncome').textContent = '0 ' + this.getCurrencySymbol();
                    document.getElementById('totalOperations').textContent = '0';
                    document.getElementById('averageOperation').textContent = '0 ' + this.getCurrencySymbol();
                    return;
                }
                
                const childOperations = this.operations[this.currentChild.id];
                const filteredOperations = this.filterOperations(childOperations, this.currentStatFilter);
                
                let totalIncome = 0;
                let totalExpense = 0;
                let totalPenalty = 0;
                let totalOperations = filteredOperations.length;
                
                filteredOperations.forEach(operation => {
                    const amount = operation.amount;
                    if (operation.type === 'income') {
                        totalIncome += amount;
                    } else if (operation.type === 'expense') {
                        totalExpense += amount;
                    } else if (operation.type === 'penalty') {
                        totalPenalty += amount;
                    }
                });
                
                const netIncome = totalIncome - totalExpense - totalPenalty;
                const averageOperation = totalOperations > 0 ? 
                    Math.round((totalIncome + totalExpense + totalPenalty) / totalOperations) : 0;
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ç–µ–∫—É—â—É—é –≤–∞–ª—é—Ç—É
                const convertedTotalIncome = this.convertCurrency(totalIncome);
                const convertedTotalExpense = this.convertCurrency(totalExpense);
                const convertedTotalPenalty = this.convertCurrency(totalPenalty);
                const convertedNetIncome = this.convertCurrency(netIncome);
                const convertedAverage = this.convertCurrency(averageOperation);
                
                document.getElementById('totalIncome').textContent = 
                    `${convertedTotalIncome.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
                document.getElementById('totalExpense').textContent = 
                    `${convertedTotalExpense.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
                document.getElementById('totalPenalty').textContent = 
                    `${convertedTotalPenalty.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
                document.getElementById('netIncome').textContent = 
                    `${convertedNetIncome.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
                document.getElementById('totalOperations').textContent = totalOperations.toString();
                document.getElementById('averageOperation').textContent = 
                    `${convertedAverage.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
                
                // –†–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º —á–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥
                const netIncomeElement = document.getElementById('netIncome');
                netIncomeElement.className = 'stat-value';
                if (netIncome > 0) {
                    netIncomeElement.classList.add('stat-positive');
                } else if (netIncome < 0) {
                    netIncomeElement.classList.add('stat-negative');
                }
            }
            
            showDinoMessage(message, animation = null) {
                const dinoMessage = document.getElementById('dinoMessage');
                dinoMessage.textContent = message;
                
                dinoMessage.style.animation = 'none';
                setTimeout(() => {
                    dinoMessage.style.animation = 'pulse 2s infinite';
                }, 10);
                
                if (animation) {
                    this.animateDino(animation);
                }
                
                setTimeout(() => {
                    if (this.currentChild) {
                        const balance = this.currentChild.balance || 0;
                        if (balance > 1000) {
                            dinoMessage.textContent = '–¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å!';
                        } else if (balance > 0) {
                            dinoMessage.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!';
                        } else if (balance < 0) {
                            dinoMessage.textContent = '–û—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ —Å —Ç—Ä–∞—Ç–∞–º–∏!';
                        } else {
                            dinoMessage.textContent = '–ü–æ—Ä–∞ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å!';
                        }
                    }
                }, 5000);
            }
            
            animateDino(animation) {
                const dino = document.getElementById('dinoCharacter');
                dino.classList.add(`dino-${animation}`);
                
                setTimeout(() => {
                    dino.classList.remove(`dino-${animation}`);
                }, 1000);
            }
            
            showRandomDinoMessage() {
                const randomMessage = this.dinoMessages[Math.floor(Math.random() * this.dinoMessages.length)];
                this.showDinoMessage(randomMessage, null);
            }
            
            shareApp() {
                const appUrl = 'https://t.me/child_bank_bot';
                
                if (navigator.share) {
                    navigator.share({
                        title: '–Ø —É –º–∞–º—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å',
                        text: '–û—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –¥–µ—Ç–µ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏!',
                        url: appUrl
                    })
                    .then(() => console.log('–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å'))
                    .catch((error) => {
                        this.copyToClipboard(appUrl);
                    });
                } else {
                    this.copyToClipboard(appUrl);
                }
            }
            
            copyToClipboard(text) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    })
                    .catch(err => {
                        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    });
            }
            
            updateUI() {
                if (this.currentChild) {
                    document.getElementById('currentChildName').textContent = this.currentChild.name;
                    document.getElementById('currentChildAvatar').textContent = this.currentChild.avatar;
                    document.getElementById('cardHolderName').textContent = this.currentChild.name.toUpperCase();
                    
                    this.updateBalanceDisplay();
                    this.updateHistory();
                    
                    const balance = this.currentChild.balance || 0;
                    if (balance > 0) {
                        this.showDinoMessage(`–ë–∞–ª–∞–Ω—Å: ${this.formatCurrency(balance)}`, null);
                    }
                } else {
                    document.getElementById('currentChildName').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞';
                    document.getElementById('cardHolderName').textContent = '–í–´–ë–ï–†–ò–¢–ï –†–ï–ë–ï–ù–ö–ê';
                    document.getElementById('balanceAmount').querySelector('.balance-digits').textContent = '0';
                    document.getElementById('historyList').innerHTML = `
                        <div class="empty-history">
                            <i class="fas fa-book"></i>
                            <p>–î–æ–±–∞–≤—å—Ç–µ —Ä–µ–±–µ–Ω–∫–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
                        </div>
                    `;
                }
                
                this.renderProfilesList();
            }
            
            getChildBalance(childId) {
                const childOperations = this.operations[childId];
                if (!childOperations) return 0;
                
                return childOperations.reduce((total, op) => {
                    return op.type === 'income' ? total + op.amount : total - op.amount;
                }, 0);
            }
            
            convertCurrency(amount) {
                const rate = this.exchangeRates[this.currentCurrency];
                return Math.round(amount * rate);
            }
            
            getCurrencySymbol() {
                switch(this.currentCurrency) {
                    case 'USD': return '$';
                    case 'EUR': return '‚Ç¨';
                    default: return '‚ÇΩ';
                }
            }
            
            formatCurrency(amount) {
                const convertedAmount = this.convertCurrency(amount);
                return `${convertedAmount.toLocaleString('ru-RU')} ${this.getCurrencySymbol()}`;
            }
            
            saveToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
                    return false;
                }
            }
            
            loadFromStorage(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
                    return null;
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.kidBank = new KidBank();
        });
    </script>
</body>
</html>
